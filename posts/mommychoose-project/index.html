<!DOCTYPE html>
<html lang="zh" >

<!-- Head tag -->
<head><meta name="generator" content="Hexo 3.9.0">

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" href="/favicon.ico">

    <!-- Title -->
    
    <title>妈咪臻选小程序商城全栈开发 - BRIGHTON ZHANG</title>

    <!-- open graph -->
    
    <meta name="description" content="技术栈： vuejs + node.js">
<meta name="keywords" content="JavaScript,小程序,vuejs">
<meta property="og:type" content="article">
<meta property="og:title" content="妈咪臻选小程序商城全栈开发">
<meta property="og:url" content="https://brightonzhang.com/posts/mommychoose-project/index.html">
<meta property="og:site_name" content="BRIGHTON ZHANG">
<meta property="og:description" content="技术栈： vuejs + node.js">
<meta property="og:locale" content="zh">
<meta property="og:image" content="https://brightonzhang.com/imgs/neptune.png">
<meta property="og:updated_time" content="2019-11-26T03:52:30.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="妈咪臻选小程序商城全栈开发">
<meta name="twitter:description" content="技术栈： vuejs + node.js">
<meta name="twitter:image" content="https://brightonzhang.com/imgs/neptune.png">

    <!-- CSS -->
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css">
    
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css">
    

    <link rel="stylesheet" href="/css/style.css">

    <!-- Google Analytics -->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-114837917-1"></script>
    <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-114837917-1');
    </script>



    <!-- Baidu Tongji -->
    
    <script>
        var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            hm.src = "https://hm.baidu.com/hm.js?ca817bd39bbbac0ebd13f866fbc29749";
            var s = document.getElementsByTagName("script")[0]; 
            s.parentNode.insertBefore(hm, s);
        })();
    </script>



</head>


<body  data-spy="scroll" data-target="#tocScrollspy"  >

    <!-- Menu -->
    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">BRIGHTON</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                
                    <li>
                        <a href="/">
                            
                                Home
                            
                        </a>
                    </li>
                
                    <li>
                        <a href="/archives">
                            
                                Archives
                            
                        </a>
                    </li>
                
                    <li>
                        <a href="/tags">
                            
                                Tags
                            
                        </a>
                    </li>
                
                    <li>
                        <a href="/categories">
                            
                                Categories
                            
                        </a>
                    </li>
                
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>

    <!-- Main Content -->
    
<header class="intro-header" style="background-image: url('')">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                
                    <div class="post-heading">
                        <!-- Tags and categories -->
                        
                            <div class="post-tag-category">
                                
  <ul class="post-tag-list"><li class="post-tag-list-item"><a class="post-tag-list-link" href="/tags/JavaScript/">JavaScript</a></li><li class="post-tag-list-item"><a class="post-tag-list-link" href="/tags/vuejs/">vuejs</a></li><li class="post-tag-list-item"><a class="post-tag-list-link" href="/tags/小程序/">小程序</a></li></ul>

                                
  <div class="post-category">
    <a class="post-category-link" href="/categories/技术/">技术</a>
  </div>

                            </div>
                        

                        <h1>妈咪臻选小程序商城全栈开发</h1>
                        

                        <span class="meta">
                            <!-- Date and Author -->
                            <p class="post-meta">
    <!-- Date and Author -->
    Posted 
    

    on  <time datetime="2019-09-26T03:52:30.000Z" itemprop="datePublished">09/26/2019</time>, last updated on <time datetime="2019-11-26T03:52:30.000Z" itemprop="dateUpdated">11/26/2019</time>
    
</p>
                        </span>
                    </div>
                
            </div>
        </div>
    </div>
</header>

<!-- Post Content -->
<div class="container">
    <div class="row">
        <!-- Post Main Content -->
        
            <div class="col-lg-8 col-lg-offset-1 col-md-10 " >
        

                <article class="post-article" >
                    <p>技术栈：</p>
<p>vuejs + node.js</p>
<a id="more"></a>

<h1 id="框架选择"><a href="#框架选择" class="headerlink" title="框架选择"></a>框架选择</h1><p>要考虑后续扩展，以及后台管理系统复用，选择使用 mpvue。</p>
<h3 id="Vant-Weapp"><a href="#Vant-Weapp" class="headerlink" title="Vant Weapp"></a>Vant Weapp</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i @vant/weapp -S --production</span><br></pre></td></tr></table></figure>

<p>打开项目里的build/webpack.base.conf.js文件，在baseWebpackConfig.plugins数组里增加多一个CopyWebpackPlugin。主要是为了mpvue在编译成微信小程序开发语言的时候，也顺带把vant组件复制到目录里，这样的话才能被项目找到。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> CopyWebpackPlugin([</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">from</span>: path.resolve(__dirname, <span class="string">'../node_modules/@vant/weapp/dist'</span>),</span><br><span class="line">    to: path.resolve(config.build.assetsRoot, <span class="string">'./@vant/weapp/dist'</span>),</span><br><span class="line">    ignore: [<span class="string">'.*'</span>]</span><br><span class="line">  &#125;</span><br><span class="line">]),</span><br></pre></td></tr></table></figure>

<h3 id="引入组件"><a href="#引入组件" class="headerlink" title="引入组件"></a>引入组件</h3><p>以 Button 组件为例，只需要在<code>app.json</code>或<code>main.json</code>中配置 Button 对应的路径即可。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// app.json</span><br><span class="line">"usingComponents": &#123;</span><br><span class="line">  "van-button": "/@vant/weapp/dist/button/index"</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="使用组件"><a href="#使用组件" class="headerlink" title="使用组件"></a>使用组件</h3><p>引入组件后，可以在 wxml 中直接使用组件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">van-button</span> <span class="attr">type</span>=<span class="string">"primary"</span>&gt;</span>按钮<span class="tag">&lt;/<span class="name">van-button</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>然后可能就在微信开发者工具控制台看到报错：</p>
<p><code>thirdScriptError sdk uncaught third Error Unexpected token export SyntaxError: Unexpected token export</code></p>
<p>打开项目ES6转ES5即可。</p>
<h1 id="平台选择"><a href="#平台选择" class="headerlink" title="平台选择"></a>平台选择</h1><h2 id="小程序云开发"><a href="#小程序云开发" class="headerlink" title="小程序云开发"></a>小程序云开发</h2><p>云开发提供了云函数、数据库以及存储功能，这样似乎就可以不搭建后台后端服务器。但后来发现，云开发只提供了小程序的 API。服务端 API 还是需要后台服务器去调用。论坛看到有说要提供 JS API，但是没有时间点。所以如果仅此用于开发而不达后端服务器，没办法完成整个商城的功能。既然反正需要后端服务器，那就不在折腾云开发了。</p>
<h2 id="leancloud"><a href="#leancloud" class="headerlink" title="leancloud"></a>leancloud</h2><p>leancloud 提供了比较宽松的免费开发版本，觉得基本可以满足当前商城的使用情况。另外觉得他们家的文档写的比较好。<br>但是 LeanCloud 中国版 10 月份会开始停止为不绑定自有域名的应用服务。绑定的域名当然还得备案。而现在 LeanCloud 停止了对开发版应用进行备案或者接入的支持，他们建议的方式包括到 IaaS 服务商处自行完成备案和接入（华北节点是和 UCloud 合作，华东节点是和腾讯云合作）。<br>之前了解过腾讯云的备案要求，要求购买到云服务器三个月以上。看了一下，UCloud 没有购买时长的要求，觉得应该会便宜一些。所以选择了 UCloud 注册域名并备案。</p>
<p>除了数据库，还有大量的商品图片需要保存。LeanCloud 云端也支持「文件」类数据的存储。但是 HTTPS 文件流量无免费的使用额度，而微信小程序强制要求使用 https 访问。所以需要考虑把图片存在其他的地方。而 UCloud 提供了对象存储的功能，可以满足该需求。</p>
<h1 id="数据库设计"><a href="#数据库设计" class="headerlink" title="数据库设计"></a>数据库设计</h1><p>参考 <a href="https://leancloud.cn/docs/relation-guide.html" target="_blank" rel="noopener">数据模型设计指南</a></p>
<h1 id="一些状态常量"><a href="#一些状态常量" class="headerlink" title="一些状态常量"></a>一些状态常量</h1><h2 id="云函数错误码"><a href="#云函数错误码" class="headerlink" title="云函数错误码"></a>云函数错误码</h2><table>
<thead>
<tr>
<th>错误码</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>3001</td>
<td>用户错误</td>
</tr>
<tr>
<td>3002</td>
<td>参数错误</td>
</tr>
<tr>
<td>3003</td>
<td>会员审批失败</td>
</tr>
<tr>
<td>3100</td>
<td>商品规格错误</td>
</tr>
<tr>
<td>3101</td>
<td>商品库存不足</td>
</tr>
<tr>
<td>3102</td>
<td>商品价格错误</td>
</tr>
<tr>
<td>3110</td>
<td>订单运单信息错误</td>
</tr>
<tr>
<td>3111</td>
<td>订单状态无法直接退款</td>
</tr>
<tr>
<td>3200</td>
<td>微信支付错误</td>
</tr>
</tbody></table>
<h2 id="订单状态"><a href="#订单状态" class="headerlink" title="订单状态"></a>订单状态</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> statusMap = [</span><br><span class="line">  [<span class="string">'INIT'</span>, <span class="string">'下单'</span>],</span><br><span class="line">  [<span class="string">'PAYING'</span>, <span class="string">'待付款'</span>],</span><br><span class="line">  [<span class="string">'DELIVERING'</span>, <span class="string">'待发货'</span>],</span><br><span class="line">  [<span class="string">'RECEIVING'</span>, <span class="string">'待收货'</span>],</span><br><span class="line">  [<span class="string">'DONE'</span>, <span class="string">'已完成'</span>],</span><br><span class="line">  [<span class="string">'REFUND_RETURN_REQUESTING'</span>, <span class="string">'退货审核中'</span>],</span><br><span class="line">  [<span class="string">'REFUND_RETURNING'</span>, <span class="string">'退货中'</span>],</span><br><span class="line">  [<span class="string">'REFUND_REQUESTING'</span>, <span class="string">'退款审核中'</span>],</span><br><span class="line">  [<span class="string">'REFUNDING'</span>, <span class="string">'退款中'</span>],</span><br><span class="line">  [<span class="string">'REFUNDED'</span>, <span class="string">'已退款'</span>],</span><br><span class="line">  [<span class="string">'CANCLE'</span>, <span class="string">'已取消'</span>],</span><br><span class="line">  [<span class="string">'TIMEOUT'</span>, <span class="string">'超时未付款'</span>],</span><br><span class="line">];</span><br></pre></td></tr></table></figure>

<h1 id="踩坑记录"><a href="#踩坑记录" class="headerlink" title="踩坑记录"></a>踩坑记录</h1><h2 id="后台"><a href="#后台" class="headerlink" title="后台"></a>后台</h2><h3 id="表格拖拽排序"><a href="#表格拖拽排序" class="headerlink" title="表格拖拽排序"></a>表格拖拽排序</h3><p><a href="https://segmentfault.com/a/1190000020210917" target="_blank" rel="noopener">Element ui 表格组件+sortablejs 实现行拖拽排序</a></p>
<h3 id="图片拖拽"><a href="#图片拖拽" class="headerlink" title="图片拖拽"></a>图片拖拽</h3><p>图片拖动排序，删除实现： <a href="https://github.com/SortableJS/Vue.Draggable" target="_blank" rel="noopener">https://github.com/SortableJS/Vue.Draggable</a></p>
<h3 id="页面刷新跳转提示"><a href="#页面刷新跳转提示" class="headerlink" title="页面刷新跳转提示"></a>页面刷新跳转提示</h3><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Window/onbeforeunload" target="_blank" rel="noopener">https://developer.mozilla.org/zh-CN/docs/Web/API/Window/onbeforeunload</a></p>
<h3 id="快递查询"><a href="#快递查询" class="headerlink" title="快递查询"></a>快递查询</h3><p>快递 100：免费 100 单试用。同一个快递公司同一个运单号在同一个自然月内多次查询只计一次费用，实时扣费，费用为 0.1 元/单。</p>
<p>快递鸟：免费的即时查询接口: 限 500 次/天（即时查询 仅支持 3 家申通、圆通、中通）</p>
<p>快递鸟 NodeJS 非官方模块 <a href="https://github.com/mengkeys/kdniao" target="_blank" rel="noopener">https://github.com/mengkeys/kdniao</a></p>
<h3 id="Node-js-发送邮件"><a href="#Node-js-发送邮件" class="headerlink" title="Node.js 发送邮件"></a>Node.js 发送邮件</h3><p>Nodemailer 是一个简单易用的 Node.js 邮件发送组件</p>
<p>官网地址：<a href="https://nodemailer.com/" target="_blank" rel="noopener">https://nodemailer.com</a></p>
<p>GitHub 地址：<a href="https://github.com/nodemailer/nodemailer" target="_blank" rel="noopener">https://github.com/nodemailer/nodemailer</a></p>
<h3 id="Converting-circular-structure-to-JSON"><a href="#Converting-circular-structure-to-JSON" class="headerlink" title="Converting circular structure to JSON"></a>Converting circular structure to JSON</h3><p><a href="https://stackoverflow.com/questions/11616630/how-can-i-print-a-circular-structure-in-a-json-like-format" target="_blank" rel="noopener">https://stackoverflow.com/questions/11616630/how-can-i-print-a-circular-structure-in-a-json-like-format</a></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Demo: Circular reference</span></span><br><span class="line"><span class="keyword">var</span> circ = &#123;&#125;;</span><br><span class="line">circ.circ = circ;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Note: cache should not be re-used by repeated calls to JSON.stringify.</span></span><br><span class="line"><span class="keyword">var</span> cache = [];</span><br><span class="line"><span class="built_in">JSON</span>.stringify(circ, <span class="function"><span class="keyword">function</span>(<span class="params">key, value</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> value === <span class="string">'object'</span> &amp;&amp; value !== <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (cache.indexOf(value) !== <span class="number">-1</span>) &#123;</span><br><span class="line">            <span class="comment">// Duplicate reference found, discard key</span></span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// Store value in our collection</span></span><br><span class="line">        cache.push(value);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> value;</span><br><span class="line">&#125;);</span><br><span class="line">cache = <span class="literal">null</span>; <span class="comment">// Enable garbage collection</span></span><br></pre></td></tr></table></figure>

<h3 id="LeanCloud云引擎休眠"><a href="#LeanCloud云引擎休眠" class="headerlink" title="LeanCloud云引擎休眠"></a>LeanCloud云引擎休眠</h3><p>体验实例会执行 <a href="https://leancloud.cn/docs/leanengine_plan.html#hash633315134" target="_blank" rel="noopener">休眠策略</a>，没有请求时会休眠，有请求时启动（首次启动可能需要几秒的时间），每天最多运行 18 个小时。</p>
<h2 id="小程序"><a href="#小程序" class="headerlink" title="小程序"></a>小程序</h2><h3 id="横向滚动"><a href="#横向滚动" class="headerlink" title="横向滚动"></a>横向滚动</h3><p><a href="https://segmentfault.com/a/1190000018500042" target="_blank" rel="noopener">微信小程序 scroll-view 横向滚动的实践踩坑及隐藏其滚动条的实现</a></p>
<h3 id="mpvue-中属性表达式使用数组异常"><a href="#mpvue-中属性表达式使用数组异常" class="headerlink" title="mpvue 中属性表达式使用数组异常"></a>mpvue 中属性表达式使用数组异常</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">// 不正常</span><br><span class="line"> &lt;van-tag</span><br><span class="line">    v-for=&quot;(item, index) in sku.level1.tags&quot;</span><br><span class="line">    :key=&quot;index&quot;</span><br><span class="line">    :color=&quot;selectedSku[0] ==index?&apos;#ff0000&apos;:&apos;#000000&apos;&quot;</span><br><span class="line">    size=&quot;large&quot;</span><br><span class="line">    plain</span><br><span class="line">    @click=&quot;onSkuL1Click(index)&quot;&gt; &#123;&#123;item.name&#125;&#125; &lt;/van-tag&gt;</span><br><span class="line"></span><br><span class="line">    // 正常</span><br><span class="line"> &lt;van-tag</span><br><span class="line">    v-for=&quot;(item, index) in sku.level1.tags&quot;</span><br><span class="line">    :key=&quot;index&quot;</span><br><span class="line">    :color=&quot;selectedSkuL1 ==index?&apos;#ff0000&apos;:&apos;#000000&apos;&quot;</span><br><span class="line">    size=&quot;large&quot;</span><br><span class="line">    plain</span><br><span class="line">    @click=&quot;onSkuL1Click(index)&quot;&gt; &#123;&#123;item.name&#125;&#125; &lt;/van-tag&gt;</span><br></pre></td></tr></table></figure>

<h3 id="background-image"><a href="#background-image" class="headerlink" title="background-image"></a>background-image</h3><p>微信小程序通过 background-image 设置背景：只支持线上图片和 base64 图片，不支持本地图片；base64 图片设置步骤如下：</p>
<p>1.在网站<a href="http://imgbase64.duoshitong.com/上将图片转成base64格式的文本" target="_blank" rel="noopener">http://imgbase64.duoshitong.com/上将图片转成base64格式的文本</a></p>
<p>2.在 WXSS 中使用以上文本：background-image: url(“data:image/png;base64,iVBORw0KGgo=…”);</p>
<p>3.为了使背景图片自适应宽高，可以做如下设置：</p>
<p>background-repeat:no-repeat;</p>
<p>background-size:100% 100%;</p>
<p>-moz-background-size:100% 100%;</p>
<h3 id="物流状态时间轴"><a href="#物流状态时间轴" class="headerlink" title="物流状态时间轴"></a>物流状态时间轴</h3><p><a href="https://youzan.github.io/vant-weapp/#/steps竖向步骤条" target="_blank" rel="noopener">https://youzan.github.io/vant-weapp/#/steps竖向步骤条</a></p>
<p>可以通过设置<code>direction</code>属性来改变步骤条的显示方式</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">van-steps</span></span></span><br><span class="line"><span class="tag">  <span class="attr">steps</span>=<span class="string">"&#123;&#123; steps &#125;&#125;"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">active</span>=<span class="string">"&#123;&#123; active &#125;&#125;"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">direction</span>=<span class="string">"vertical"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">active-color</span>=<span class="string">"#ee0a24"</span></span></span><br><span class="line"><span class="tag">/&gt;</span></span><br></pre></td></tr></table></figure>

<p>信小程序之物流状态时间轴](<a href="https://juejin.im/post/5bd17b0be51d457ab36d00b3" target="_blank" rel="noopener">https://juejin.im/post/5bd17b0be51d457ab36d00b3</a>) <a href="https://github.com/super456/weapp_expressTime" target="_blank" rel="noopener">https://github.com/super456/weapp_expressTime</a></p>
<h3 id="微信退款"><a href="#微信退款" class="headerlink" title="微信退款"></a>微信退款</h3><p><a href="https://pay.weixin.qq.com/wiki/doc/api/jsapi.php?chapter=9_4" target="_blank" rel="noopener">https://pay.weixin.qq.com/wiki/doc/api/jsapi.php?chapter=9_4</a><br><a href="https://www.npmjs.com/package/weixin-pay" target="_blank" rel="noopener">https://www.npmjs.com/package/weixin-pay</a></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> params = &#123;</span><br><span class="line">    <span class="comment">// appid: 'xxxxxxxx',</span></span><br><span class="line">    <span class="comment">// mch_id: '1234567890',</span></span><br><span class="line">    <span class="comment">// op_user_id: '商户号即可',</span></span><br><span class="line">    out_refund_no: <span class="string">'20140703'</span>+<span class="built_in">Math</span>.random().toString().substr(<span class="number">2</span>, <span class="number">10</span>),</span><br><span class="line">    total_fee: <span class="string">'1'</span>, <span class="comment">//原支付金额</span></span><br><span class="line">    refund_fee: <span class="string">'1'</span>, <span class="comment">//退款金额</span></span><br><span class="line">    transaction_id: <span class="string">'微信订单号'</span></span><br><span class="line">&#125;;</span><br><span class="line"> </span><br><span class="line">wxpay.refund(params, <span class="function"><span class="keyword">function</span>(<span class="params">err, result</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'refund'</span>, <span class="built_in">arguments</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>微信支付接口中，涉及资金回滚的接口会使用到API证书，包括退款、撤销接口。商家在申请微信支付成功后，收到的相应邮件后，可以按照指引下载API证书，也可以按照以下路径下载：微信商户平台(pay.weixin.qq.com)–&gt;账户中心–&gt;账户设置–&gt;API安全 。</p>
<h3 id="文字跑马灯"><a href="#文字跑马灯" class="headerlink" title="文字跑马灯"></a>文字跑马灯</h3><p>实现一个微信小程序组件：文字跑马灯效果 <a href="https://www.jianshu.com/p/0ff03e5e942e" target="_blank" rel="noopener">https://www.jianshu.com/p/0ff03e5e942e</a></p>
<p>改为使用van-notice-bar：  <a href="https://youzan.github.io/vant-weapp/#/notice-bar" target="_blank" rel="noopener">https://youzan.github.io/vant-weapp/#/notice-bar</a></p>
<h4 id="组件生命周期"><a href="#组件生命周期" class="headerlink" title="组件生命周期"></a>组件生命周期</h4><p>组件的生命周期，指的是组件自身的一些函数，这些函数在特殊的时间点或遇到一些特殊的框架事件时被自动触发。</p>
<p>其中，最重要的生命周期是 <code>created</code> <code>attached</code> <code>detached</code> ，包含一个组件实例生命流程的最主要时间点。</p>
<ul>
<li>组件实例刚刚被创建好时， <code>created</code> 生命周期被触发。此时，组件数据 <code>this.data</code> 就是在 <code>Component</code> 构造器中定义的数据 <code>data</code> 。 <strong>此时还不能调用 <code>setData</code> 。</strong> 通常情况下，这个生命周期只应该用于给组件 <code>this</code> 添加一些自定义属性字段。</li>
<li>在组件完全初始化完毕、进入页面节点树后， <code>attached</code> 生命周期被触发。此时， <code>this.data</code> 已被初始化为组件的当前值。这个生命周期很有用，绝大多数初始化工作可以在这个时机进行。</li>
<li>在组件离开页面节点树后， <code>detached</code> 生命周期被触发。退出一个页面时，如果组件还在页面节点树中，则 <code>detached</code> 会被触发。</li>
</ul>
<h3 id="env-safe-area-inset-bottom"><a href="#env-safe-area-inset-bottom" class="headerlink" title="env(safe-area-inset-bottom)"></a>env(safe-area-inset-bottom)</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.login-button</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: fixed;</span><br><span class="line">  <span class="attribute">bottom</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">bottom</span>: <span class="built_in">env</span>(safe-area-inset-bottom);</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">right</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">750</span>rpx;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">50PX</span>;</span><br><span class="line">  <span class="attribute">z-index</span>: <span class="number">300</span>;</span><br><span class="line">  <span class="attribute">border-color</span>: transparent;</span><br><span class="line">  // background: yellow;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a href="https://www.cnblogs.com/hjj2ldq/p/11579260.html" target="_blank" rel="noopener">https://www.cnblogs.com/hjj2ldq/p/11579260.html</a></p>
<h2 id><a href="#" class="headerlink" title="#"></a>#</h2>
                </article>
            </div>

        
            <div class="col-lg-3  col-md-2 hidden-xs hidden-sm" id="tocScrollspy">
                 <aside class="toc-wrap nav" data-spy="affix">
    <strong class="toc-title">Contents</strong>
    <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#框架选择"><span class="toc-number">1.</span> <span class="toc-text">框架选择</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Vant-Weapp"><span class="toc-number">1.0.1.</span> <span class="toc-text">Vant Weapp</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#引入组件"><span class="toc-number">1.0.2.</span> <span class="toc-text">引入组件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#使用组件"><span class="toc-number">1.0.3.</span> <span class="toc-text">使用组件</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#平台选择"><span class="toc-number">2.</span> <span class="toc-text">平台选择</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#小程序云开发"><span class="toc-number">2.1.</span> <span class="toc-text">小程序云开发</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#leancloud"><span class="toc-number">2.2.</span> <span class="toc-text">leancloud</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#数据库设计"><span class="toc-number">3.</span> <span class="toc-text">数据库设计</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#一些状态常量"><span class="toc-number">4.</span> <span class="toc-text">一些状态常量</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#云函数错误码"><span class="toc-number">4.1.</span> <span class="toc-text">云函数错误码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#订单状态"><span class="toc-number">4.2.</span> <span class="toc-text">订单状态</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#踩坑记录"><span class="toc-number">5.</span> <span class="toc-text">踩坑记录</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#后台"><span class="toc-number">5.1.</span> <span class="toc-text">后台</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#表格拖拽排序"><span class="toc-number">5.1.1.</span> <span class="toc-text">表格拖拽排序</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#图片拖拽"><span class="toc-number">5.1.2.</span> <span class="toc-text">图片拖拽</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#页面刷新跳转提示"><span class="toc-number">5.1.3.</span> <span class="toc-text">页面刷新跳转提示</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#快递查询"><span class="toc-number">5.1.4.</span> <span class="toc-text">快递查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Node-js-发送邮件"><span class="toc-number">5.1.5.</span> <span class="toc-text">Node.js 发送邮件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Converting-circular-structure-to-JSON"><span class="toc-number">5.1.6.</span> <span class="toc-text">Converting circular structure to JSON</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#LeanCloud云引擎休眠"><span class="toc-number">5.1.7.</span> <span class="toc-text">LeanCloud云引擎休眠</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#小程序"><span class="toc-number">5.2.</span> <span class="toc-text">小程序</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#横向滚动"><span class="toc-number">5.2.1.</span> <span class="toc-text">横向滚动</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mpvue-中属性表达式使用数组异常"><span class="toc-number">5.2.2.</span> <span class="toc-text">mpvue 中属性表达式使用数组异常</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#background-image"><span class="toc-number">5.2.3.</span> <span class="toc-text">background-image</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#物流状态时间轴"><span class="toc-number">5.2.4.</span> <span class="toc-text">物流状态时间轴</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#微信退款"><span class="toc-number">5.2.5.</span> <span class="toc-text">微信退款</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#文字跑马灯"><span class="toc-number">5.2.6.</span> <span class="toc-text">文字跑马灯</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#组件生命周期"><span class="toc-number">5.2.6.1.</span> <span class="toc-text">组件生命周期</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#env-safe-area-inset-bottom"><span class="toc-number">5.2.7.</span> <span class="toc-text">env(safe-area-inset-bottom)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#null"><span class="toc-number">5.3.</span> <span class="toc-text">#</span></a></li></ol></li></ol>
</aside>
            </div>
        
    </div>

    <div class="row">
        <!-- Comments -->
         
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1 post-comment">
                <hr />
<!-- <h3>comment:</h3> -->

    <div id="vcomments"></div>
    <script src='//cdn.jsdelivr.net/npm/valine/dist/Valine.min.js'></script>
    <script>
        new Valine({
            el: '#vcomments',
            appId: 'rf9KhKGBt9w4pNpcXT8H0v8n-MdYXbMMI',
            appKey: 'cp5GJeuotYOQqqyOrf4MNnoA',
            placeholder: '欢迎留言交流',
            pageSize: '8',
            visitor: 'true'
        });
    </script>



            </div>
        
    </div>
    
    <div class="row">
         
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1 post-comment">
                <div class="donate">
  <hr />
  <p>如果喜欢，欢迎请作者喝咖啡☕️☕️☕️</p>
  <div style="text-align: center;">
    
    <img src="/imgs/wechat.jpg" alt="" height="128px" width="128px" />
    
    <img src="/imgs/alipay.jpg" alt="" height="128px" width="128px" />
    
  </div>
</div>

            </div>
        
    </div>
</div>

    
    <div id="totop" title="Let me fly">
    <canvas id="totop-canvas" width="48" height="48"></canvas>
    <div id="totop-percent"></div>
</div>

    <!-- Footer -->
    <footer>
    <hr />

    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                    
                        <li>
                            <a href="https://twitter.com/brightonzhang" target="_blank" rel="external nofollow">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li>
                    

                    

                    
                        <li>
                            <a href="https://github.com/brightonzhang" target="_blank" rel="external nofollow">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li>
                    

                    

                    
                        <li>
                            <a href="mailto:hello@brightonzhang.com" target="_blank" rel="external nofollow">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fa fa-envelope-o fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li>
                    

                    
                </ul>

                <p class="copyright text-muted">
                    &copy; 2020 Brighton Zhang<br>
                    Powered by <a href="http://hexo.io/" target="_blank" rel="external nofollow">Hexo</a> ⌘ 
                    Theme from <a href="https://github.com/brightonzhang/hexo-theme-nutshell" target="_blank" rel="external nofollow">Nutshell</a>

                    
                        
                            
                                ⌘ Deployed on <a href="https://github.com/brightonzhang/brightonzhang.com.git" target="_blank" rel="external nofollow">GitHub Pages</a>
                                
                    
                    <br/>
                </p>
            </div>
        </div>
    </div>
</footer>


    <!-- After footer scripts -->
    
<script src="//cdn.jsdelivr.net/npm/jquery@2.2.4/dist/jquery.min.js"></script>
<script src="//cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/js/bootstrap.min.js"></script>


    <script src="//cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script>




<script src="/js/script.min.js"></script>






</body>

</html>