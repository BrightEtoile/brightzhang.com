<!DOCTYPE html>
<html lang="zh" >

<!-- Head tag -->
<head><meta name="generator" content="Hexo 3.9.0">

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" href="/favicon.ico">

    <!-- Title -->
    
    <title>美好生活，从SSH Config开始 - BRIGHTON ZHANG</title>

    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css">
    
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css">
    

    <link rel="stylesheet" href="/css/style.css">

    <!-- Google Analytics -->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-114837917-1"></script>
    <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-114837917-1');
    </script>



    <!-- Baidu Tongji -->
    
    <script>
        var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            hm.src = "https://hm.baidu.com/hm.js?ca817bd39bbbac0ebd13f866fbc29749";
            var s = document.getElementsByTagName("script")[0]; 
            s.parentNode.insertBefore(hm, s);
        })();
    </script>



</head>


<body  data-spy="scroll" data-target="#tocScrollspy"  >

    <!-- Menu -->
    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">BRIGHTON</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                
                    <li>
                        <a href="/">
                            
                                Home
                            
                        </a>
                    </li>
                
                    <li>
                        <a href="/archives">
                            
                                Archives
                            
                        </a>
                    </li>
                
                    <li>
                        <a href="/tags">
                            
                                Tags
                            
                        </a>
                    </li>
                
                    <li>
                        <a href="/categories">
                            
                                Categories
                            
                        </a>
                    </li>
                
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>

    <!-- Main Content -->
    
<header class="intro-header" style="background-image: url('')">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                
                    <div class="post-heading">
                        <!-- Tags and categories -->
                        
                            <div class="post-tag-category">
                                
  <ul class="post-tag-list"><li class="post-tag-list-item"><a class="post-tag-list-link" href="/tags/Linux/">Linux</a></li><li class="post-tag-list-item"><a class="post-tag-list-link" href="/tags/SSH/">SSH</a></li></ul>

                                
  <div class="post-category">
    <a class="post-category-link" href="/categories/巧技/">巧技</a>
  </div>

                            </div>
                        

                        <h1>美好生活，从SSH Config开始</h1>
                        

                        <span class="meta">
                            <!-- Date and Author -->
                            <p class="post-meta">
    <!-- Date and Author -->
    Posted 
    

    on  <time datetime="2019-01-31T10:04:07.000Z" itemprop="datePublished">01/31/2019</time>

    
</p>
                        </span>
                    </div>
                
            </div>
        </div>
    </div>
</header>

<!-- Post Content -->
<div class="container">
    <div class="row">
        <!-- Post Main Content -->
        
            <div class="col-lg-8 col-lg-offset-1 col-md-10 " >
        

                <article class="post-article" >
                    <p>每次ssh登陆主机还要输密码，好麻烦！<br>多个Git服务器，公司的代码库、自己的GitHub，多个ssh key怎么搞？</p>
<p>其实，这些都可以通过SSH配置来简化。<br><a id="more"></a> </p>
<h1 id="Key-Based-SSH登陆"><a href="#Key-Based-SSH登陆" class="headerlink" title="Key-Based SSH登陆"></a>Key-Based SSH登陆</h1><p>Key-based authentication is the most secure of several modes of authentication usable with OpenSSH, such as plain password and Kerberos tickets. SSH can use either “RSA” (Rivest-Shamir-Adleman) or “DSA” (“Digital Signature Algorithm”) keys. Both of these were considered state-of-the-art algorithms when SSH was invented, but DSA has come to be seen as less secure in recent years.<br>下面介绍基于rsa密钥的ssh登陆，免去密码输入之痛。</p>
<p>首先在客户端生成密钥对：执行如下命令，并根据提示输入密码等信息。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa -b 4096 -C "brighton@winterfell" -f ~/.ssh/winterfell</span><br></pre></td></tr></table></figure>
<p>其中：<br><code>-t</code>，指定算法；<br><code>-b</code>，指定密钥长度，bit位数；<br><code>-C</code>，指定密钥标签，会标注在公钥末尾;<br><code>-f</code>，指定输出文件名，如果不设置，后续也会有提示输入。</p>
<p>如此，会生成一对RSA密钥，其中winterfell为私钥，winterfell.pub为公钥。</p>
<p>然后将公钥配置到需要登陆的主机上。先使用密码登陆主机，将上一步生成的winterfell.pub内容保存到authorized_keys中。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat winterfell.pub &gt;&gt; ~/.ssh/authorized_keys</span><br></pre></td></tr></table></figure>
<p>主机SSH服务端的配置在<code>/etc/ssh/sshd_config</code>，可以查看相关设置。</p>
<p>至此，我们可以通过ssh登陆主机并使用<code>-i</code>参数指定密钥：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -i ~/.ssh/winterfell brighton@winterfell</span><br></pre></td></tr></table></figure>
<p>更多Key-based ssh登陆可以参考<a href="https://help.ubuntu.com/community/SSH/OpenSSH/Keys" target="_blank" rel="noopener">Ubuntu Help SSH/OpenSSH/Keys</a>。</p>
<h1 id="ssh-config文件"><a href="#ssh-config文件" class="headerlink" title="ssh config文件"></a>ssh config文件</h1><p>当有多台主机时，每次都要指定密钥，用户名等也是非常麻烦，我们使用ssh config文件来配置，简化命令输入。</p>
<p>一般，ssh config文件有两个:</p>
<ol>
<li>用户配置文件，<code>~/.ssh/config</code></li>
<li>系统配置文件，<code>/etc/ssh/ssh_config</code></li>
</ol>
<p>配置文件格式:</p>
<ul>
<li>Empty lines and lines starting with ‘#’ are comments.</li>
<li>Each line begins with a keyword, followed by argument(s).</li>
<li>Configuration options may be separated by whitespace or optional whitespace and exactly one =.</li>
<li>Arguments may be enclosed in double quotes (“) in order to specify arguments that contain spaces.</li>
</ul>
<p>常用配置参数<br><code>Host</code>: Restricts the following declarations to be only for those hosts that match one of the patterns given after the keyword. The pattern is matched against the host name given on the command line.<br><code>HostName</code>: Specifies the real host name to log into. This can be used to specify nicknames or abbreviations for hosts. The default is the name given on the command line. Numeric IP addresses are also permitted (both on the command line and in HostName specifications).<br><code>IdentityFile</code>: Specifies a file from which the user’s identity key is read when using public key authentication. The default for protocol version 1 is ~/.ssh/identity; and ~/.ssh/id_rsa or ~/.ssh/id_dsa for protocol version 2.<br><code>Port</code>: Specifies the port number to connect on the remote host. The default is 22.<br><code>User</code>: Specifies the user to log in as. This can be useful when a different user name is used on different machines. This saves the trouble of having to remember to give the user name on the command line.<br>更多参数请参考<a href="http://man.openbsd.org/OpenBSD-current/man5/ssh_config.5" target="_blank" rel="noopener">SSH man page</a>.</p>
<p>如此，我的<code>~/.ssh/config</code>示例:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">Host winterfell</span><br><span class="line">    HostName winterfell</span><br><span class="line">    User brighton</span><br><span class="line">    IdentityFile ~/.ssh/winterfell</span><br><span class="line"></span><br><span class="line">Host vultrsv</span><br><span class="line">    HostName 2001:*:9ee2</span><br><span class="line">    User brighton</span><br><span class="line">    IdentityFile ~/.ssh/vultr</span><br><span class="line"></span><br><span class="line">Host bwhlacn2</span><br><span class="line">    HostName 95.*.115</span><br><span class="line">    Port 29726</span><br><span class="line">    User brighton</span><br><span class="line">    IdentityFile ~/.ssh/bwhlacn2</span><br><span class="line"></span><br><span class="line"># GitLab.com server</span><br><span class="line">Host gitlab.com</span><br><span class="line">    # RSAAuthentication yes</span><br><span class="line">    IdentityFile ~/.ssh/gitlabaaa</span><br></pre></td></tr></table></figure>
<p>这样以来，<code>ssh winterfell</code>即可登陆winterfell路由器，<code>ssh vultrsv</code>即可登陆IP为2001:*:9ee2的主机。</p>
<p>Done!</p>

                </article>
            </div>

        
            <div class="col-lg-3  col-md-2 hidden-xs hidden-sm" id="tocScrollspy">
                 <aside class="toc-wrap nav" data-spy="affix" data-offset-top="565" >
    <strong class="toc-title">Contents</strong>
    <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Key-Based-SSH登陆"><span class="toc-number">1.</span> <span class="toc-text">Key-Based SSH登陆</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ssh-config文件"><span class="toc-number">2.</span> <span class="toc-text">ssh config文件</span></a></li></ol>
</aside>
            </div>
        
    </div>

    <div class="row">
        <!-- Comments -->
        
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                


            </div>
        
    </div>
</div>

    
    <div id="totop" title="Let me fly">
    <canvas id="totop-canvas" width="48" height="48"></canvas>
    <div id="totop-percent"></div>
</div>

    <!-- Footer -->
    <hr />

<!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                    
                        <li>
                            <a href="https://twitter.com/brightonzhang" target="_blank">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li>
                    

                    

                    
                        <li>
                            <a href="https://github.com/brightonzhang" target="_blank">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li>
                    

                    

                    
                        <li>
                            <a href="mailto:hello@brightonzhang.com" target="_blank">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fa fa-envelope-o fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li>
                    

                    
                </ul>

                <p class="copyright text-muted">
                    &copy; 2019 Brighton Zhang<br>
                    Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> ⌘ 
                    Theme from <a href="https://github.com/brightonzhang/hexo-theme-nutshell" target="_blank">Nutshell</a>
                    
                    ⌘ Deployed on <a href="https://github.com/brightonzhang/brightonzhang.com.git" target="_blank">GitHub Pages</a>
                    
                </p>
            </div>
        </div>
    </div>
</footer>


    <!-- After footer scripts -->
    
<script src="//cdn.jsdelivr.net/npm/jquery@2.2.4/dist/jquery.min.js"></script>
<script src="//cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/js/bootstrap.min.js"></script>


    <script src="//cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script>




<script src="/js/script.min.js"></script>

<!-- Disqus Comments -->







</body>

</html>